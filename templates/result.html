{% extends 'base.html' %}
{% block title %}Result - Order Availability Checker{% endblock %}
{% block content %}
    <div class="container py-5">
      <div class="d-flex align-items-center justify-content-between mb-4">
        <h1 class="h4 m-0">Result</h1>
        <div class="text-muted small">Stock: <strong>{{ stock_name }}</strong> Â· Order: <strong>{{ order_name }}</strong></div>
      </div>

      <div class="row g-4 mb-4">
        <div class="col-12 col-md-3">
          <div class="stat-card bg-primary text-white">
            <div class="label">Total Items</div>
            <div class="value">{{ summary.total_items }}</div>
            <div class="small">Total KG: {{ summary.total_kg_all }}</div>
          </div>
        </div>
        <div class="col-12 col-md-3">
          <div class="stat-card bg-success text-white">
            <div class="label">Full</div>
            <div class="value">{{ summary.full }}</div>
            <div class="small">Total KG: {{ summary.total_kg_full }}</div>
          </div>
        </div>
        <div class="col-12 col-md-3">
          <div class="stat-card bg-warning text-dark">
            <div class="label">Not Full</div>
            <div class="value">{{ summary.not_full }}</div>
            <div class="small">Total KG: {{ summary.total_kg_not_full }}</div>
          </div>
        </div>
        <div class="col-12 col-md-3">
          <div class="stat-card bg-secondary text-white">
            <div class="label">Not have</div>
            <div class="value">{{ summary.not_have }}</div>
            <div class="small">Total KG: {{ summary.total_kg_not_have }}</div>
          </div>
        </div>
      </div>

      <ul class="nav nav-pills mb-3" id="statusTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="tab-all" data-bs-toggle="pill" data-bs-target="#pane-all" type="button" role="tab">All</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="tab-full" data-bs-toggle="pill" data-bs-target="#pane-full" type="button" role="tab">Full</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="tab-notfull" data-bs-toggle="pill" data-bs-target="#pane-notfull" type="button" role="tab">Not Full</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="tab-nothave" data-bs-toggle="pill" data-bs-target="#pane-nothave" type="button" role="tab">Not have</button>
        </li>
      </ul>

      <div class="tab-content">
        <div class="tab-pane fade show active" id="pane-all" role="tabpanel">
          <div class="card shadow-sm border-0 rounded-4 mb-4">
            <div class="card-body p-0">
              <div class="table-responsive">
                <table class="table table-hover align-middle m-0">
              <thead class="table-light">
                <tr>
                  <th style="min-width: 220px">Fish Name</th>
                  <th>Packed Size</th>
                  <th class="text-end">Order CTN</th>
                  <th class="text-end">Stock CTN</th>
                  <th class="text-end">Order KG/CTN</th>
                  <th class="text-end">Stock KG/CTN</th>
                  <th class="text-end">Balance Stock CTN</th>
                   <th class="text-end">MC To Give</th>
                   <th class="text-end">Can Fulfill</th>
                  <th class="text-end">Shortfall</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                {% for r in records %}
                <tr class="status-{{ r.status|lower|replace(' ', '-') }}">
                  <td>{{ r['fish name'] }}</td>
                  <td>{{ r['packed size'] }}</td>
                  <td class="text-end">{{ r.order_carton }}</td>
                  <td class="text-end">{{ r.stock_carton }}</td>
                  <td class="text-end">{{ r.order_kg_per_ctn }}</td>
                  <td class="text-end">{{ r.stock_kg_per_ctn }}</td>
                  <td class="text-end">{{ r.balance_stock_carton }}</td>
                  <td class="text-end">{{ r.mc_to_give }}</td>
                  <td class="text-end">{{ r.can_fulfill_carton }}</td>
                  <td class="text-end">{{ r.shortfall }}</td>
                  <td>
                    {% if r.status == 'Full' %}
                      <span class="badge bg-success">Full</span>
                    {% elif r.status == 'Not Full' %}
                      <span class="badge bg-warning text-dark">Not Full</span>
                    {% else %}
                      <span class="badge bg-secondary">Not have</span>
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        {% for label in ['Full','Not Full','Not have'] %}
        <div class="tab-pane fade" id="pane-{{ label|lower|replace(' ', '') }}" role="tabpanel">
          <div class="card shadow-sm border-0 rounded-4 mb-4">
            <div class="card-body p-0">
              <div class="table-responsive">
                <table class="table table-hover align-middle m-0">
                  <thead class="table-light">
                    <tr>
                      <th style="min-width: 220px">Fish Name</th>
                      <th>Packed Size</th>
                      <th class="text-end">Order CTN</th>
                      <th class="text-end">Stock CTN</th>
                      <th class="text-end">Order KG/CTN</th>
                      <th class="text-end">Stock KG/CTN</th>
                      <th class="text-end">Balance Stock CTN</th>
                      <th class="text-end">MC To Give</th>
                      <th class="text-end">Can Fulfill</th>
                      <th class="text-end">Shortfall</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for r in records if r.status == label %}
                    <tr class="status-{{ r.status|lower|replace(' ', '-') }}">
                      <td>{{ r['fish name'] }}</td>
                      <td>{{ r['packed size'] }}</td>
                      <td class="text-end">{{ r.order_carton }}</td>
                      <td class="text-end">{{ r.stock_carton }}</td>
                      <td class="text-end">{{ r.order_kg_per_ctn }}</td>
                      <td class="text-end">{{ r.stock_kg_per_ctn }}</td>
                      <td class="text-end">{{ r.balance_stock_carton }}</td>
                      <td class="text-end">{{ r.mc_to_give }}</td>
                      <td class="text-end">{{ r.can_fulfill_carton }}</td>
                      <td class="text-end">{{ r.shortfall }}</td>
                      <td>
                        {% if r.status == 'Full' %}
                          <span class="badge bg-success">Full</span>
                        {% elif r.status == 'Not Full' %}
                          <span class="badge bg-warning text-dark">Not Full</span>
                        {% else %}
                          <span class="badge bg-secondary">Not have</span>
                        {% endif %}
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>

      <div class="d-flex gap-2">
        <a class="btn btn-outline-secondary" href="{{ url_for('index') }}">Process Another</a>
        <a class="btn btn-primary" href="{{ url_for('download_excel', token=download_token) }}">Download Excel</a>
        <a class="btn btn-outline-primary" href="{{ url_for('download_pdf', token=download_token) }}">Download PDF</a>
      </div>
    </div>
{% endblock %}

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


